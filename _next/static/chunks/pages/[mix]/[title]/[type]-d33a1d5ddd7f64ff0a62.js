_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[9],{BsWD:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("a3WO");function o(e,t){if(e){if("string"===typeof e)return Object(n.a)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(n.a)(e,t):void 0}}},KQm4:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r("a3WO");var o=r("BsWD");function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},"N+kb":function(e,t,r){"use strict";r.r(t),r.d(t,"__N_SSG",(function(){return R}));var n=r("q1tI"),o=r.n(n);var c=r("BsWD");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,c=void 0;try{for(var a,f=e[Symbol.iterator]();!(n=(a=f.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){o=!0,c=s}finally{try{n||null==f.return||f.return()}finally{if(o)throw c}}return r}}(e,t)||Object(c.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f=r("KQm4"),s=o.a.createElement,u=13.5,i={4:"/stepcharts/arrow4.svg",6:"/stepcharts/arrow6.svg",8:"/stepcharts/arrow8.svg",12:"/stepcharts/arrow6.svg",16:"/stepcharts/arrow16.svg",shock:"/stepcharts/arrowShock.svg",freeze:"/stepcharts/arrowFreeze.svg"},d={0:"-90deg",1:"180deg",2:"0",3:"90deg"},p=function(e,t){return 4*e*16*t},h=function(e){var t=e.offset,r=e.speed,n={position:"absolute",top:"".concat(p(t,r),"vh"),width:1,height:1};return s("div",{style:n})},l=function(e){var t=e.beat,r=e.direction,n=e.offset,o=e.speed,c={position:"absolute",top:"".concat(p(n,o)-6.75,"vh"),left:"".concat(r*u,"vh"),height:"".concat(u,"vh"),width:"".concat(u,"vh"),background:"url(".concat(i[t],")"),backgroundSize:"cover",transform:"rotate(".concat(d[r],")")};return s("div",{style:c})},v=function(e){var t=e.direction,r=e.offset,n=e.endOffset,c=e.speed,a={position:"absolute",top:"".concat(p(r,c),"vh"),left:"".concat(t*u+.675,"vh"),height:"".concat(4*(n-r-.25)*c*16,"vh"),width:"".concat(12.15,"vh"),backgroundColor:"#5e5"},f={position:"absolute",top:"".concat(p(n-.25,c),"vh"),left:"".concat(t*u+.675,"vh"),height:"".concat(6.075,"vh"),width:"".concat(12.15,"vh"),backgroundColor:"#3b3"};return s(o.a.Fragment,null,s("div",{style:a}),s("div",{style:f}))},m=function(e){var t=e.offset,r=e.speed,n=e.color,o={position:"absolute",height:0,width:"".concat(54,"vh"),left:0,top:"".concat(p(t,r),"vh"),border:"2px solid ".concat(n)};return s("div",{style:o})},b=function(e){var t=e.chart,r=e.speed,n=void 0===r?1:r,c=Math.floor(t.arrows[t.arrows.length-1].offset),a=Object(f.a)(t.arrows).reverse(),u=Object(f.a)(t.freezes).reverse();return s(o.a.Fragment,null,Object(f.a)(Array(4*(c+1))).map((function(e,t){return s(m,{key:"b".concat(t),offset:t/4,speed:n,color:t%4===0?"#888":"#444"})})),t.bpm.map((function(e,t,r){return 0===t?null:r[t-1].bpm<e.bpm?s(m,{key:"ts".concat(t),offset:e.startOffset,speed:n,color:"#fc4"}):s(m,{key:"ts".concat(t),offset:e.startOffset,speed:n,color:"#4cf"})})),t.stops.map((function(e,t){return s(m,{key:"s".concat(t),offset:e.offset,speed:n,color:"#4f4"})})),u.map((function(e,t){return s(v,{key:"f".concat(t),direction:e.direction,offset:e.startOffset,endOffset:e.endOffset,speed:n})})),a.map((function(e,t){var r=e.direction.match(/2/)?"freeze":e.beat;return s(o.a.Fragment,null,e.direction.match(/^1.../)&&s(l,{key:"a".concat(t,"l"),beat:r,direction:0,offset:e.offset,speed:n}),e.direction.match(/^.1../)&&s(l,{key:"a".concat(t,"d"),beat:r,direction:1,offset:e.offset,speed:n}),e.direction.match(/^..1./)&&s(l,{key:"a".concat(t,"u"),beat:r,direction:2,offset:e.offset,speed:n}),e.direction.match(/^...1/)&&s(l,{key:"a".concat(t,"r"),beat:r,direction:3,offset:e.offset,speed:n}),e.direction.match(/^2.../)&&s(l,{key:"a".concat(t,"l"),beat:"freeze",direction:0,offset:e.offset,speed:n}),e.direction.match(/^.2../)&&s(l,{key:"a".concat(t,"d"),beat:"freeze",direction:1,offset:e.offset,speed:n}),e.direction.match(/^..2./)&&s(l,{key:"a".concat(t,"u"),beat:"freeze",direction:2,offset:e.offset,speed:n}),e.direction.match(/^...2/)&&s(l,{key:"a".concat(t,"r"),beat:"freeze",direction:3,offset:e.offset,speed:n}),e.direction.match(/^M.../)&&s(l,{key:"a".concat(t,"l"),beat:"shock",direction:0,offset:e.offset,speed:n}),e.direction.match(/^.M../)&&s(l,{key:"a".concat(t,"d"),beat:"shock",direction:1,offset:e.offset,speed:n}),e.direction.match(/^..M./)&&s(l,{key:"a".concat(t,"u"),beat:"shock",direction:2,offset:e.offset,speed:n}),e.direction.match(/^...M/)&&s(l,{key:"a".concat(t,"r"),beat:"shock",direction:3,offset:e.offset,speed:n}))})),s(h,{offset:c+2,speed:n}))},y=o.a.memo(b),w=function(e){var t=e.offset,r=void 0===t?0:t,n=e.speed,c=void 0===n?1:n,a=e.children,f=o.a.useRef(null),u={position:"relative",width:"".concat(54,"vh"),height:"100vh",backgroundColor:"black",overflow:"scroll"};return o.a.useEffect((function(){f.current&&(f.current.scrollTop=p(r,c)*window.innerHeight/100)}),[f,r,c]),s("div",{ref:f,style:u},a)},k=function(e){var t=e.chart,r=e.speed,n=void 0===r?1:r,o=e.offset;return s(w,{offset:void 0===o?0:o,speed:n},s(y,{chart:t,speed:n}))},g=r("o0o1"),x=r.n(g);function O(e,t,r,n,o,c,a){try{var f=e[c](a),s=f.value}catch(u){return void r(u)}f.done?t(s):Promise.resolve(s).then(n,o)}var A=function(e){var t=e.audioContext,r=e.chart,n=e.offset,c=o.a.useRef(),a=o.a.useRef(),f=o.a.useRef(),s=o.a.useRef(),u=o.a.useRef(),i=o.a.useRef(),d=o.a.useRef();o.a.useEffect((function(){(function(){var e,r=(e=x.a.mark((function e(){var r,n,o,p,h,l,v,m,b,y;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=52;break}return e.next=3,fetch("/stepcharts/cursor12.mp3");case 3:return r=e.sent,e.next=6,fetch("/stepcharts/cursor4.mp3");case 6:return n=e.sent,e.next=9,fetch("/stepcharts/cancel1.mp3");case 9:return o=e.sent,e.next=12,fetch("/stepcharts/cursor7.mp3");case 12:return p=e.sent,e.next=15,fetch("/stepcharts/cursor6.mp3");case 15:return h=e.sent,e.next=18,r.arrayBuffer();case 18:return l=e.sent,e.next=21,n.arrayBuffer();case 21:return v=e.sent,e.next=24,o.arrayBuffer();case 24:return m=e.sent,e.next=27,p.arrayBuffer();case 27:return b=e.sent,e.next=30,h.arrayBuffer();case 30:return y=e.sent,e.next=33,t.decodeAudioData(l);case 33:return c.current=e.sent,e.next=36,t.decodeAudioData(v);case 36:return a.current=e.sent,e.next=39,t.decodeAudioData(m);case 39:return f.current=e.sent,e.next=42,t.decodeAudioData(b);case 42:return s.current=e.sent,e.next=45,t.decodeAudioData(y);case 45:u.current=e.sent,i.current=new GainNode(t),i.current.gain.value=2,i.current.connect(t.destination),d.current=new GainNode(t),d.current.gain.value=.25,d.current.connect(t.destination);case 52:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var c=e.apply(t,r);function a(e){O(c,n,o,a,f,"next",e)}function f(e){O(c,n,o,a,f,"throw",e)}a(void 0)}))});return function(){return r.apply(this,arguments)}})()()}),[t]);var p=o.a.useRef(0),h=o.a.useRef(Math.floor(r.arrows[r.arrows.length-1].offset)+1);o.a.useEffect((function(){if(t&&u.current&&d.current&&h.current&&p.current<=n&&n<=h.current){var e=new AudioBufferSourceNode(t);e.buffer=u.current,e.connect(d.current),e.start(),p.current=p.current+.25}}),[n]);var l=o.a.useRef(0);o.a.useEffect((function(){if(t&&c.current&&s.current&&r.arrows[l.current]&&r.arrows[l.current].offset<=n){var e,o=new AudioBufferSourceNode(t),a=r.arrows[l.current].direction.match(/M/),f=r.arrows[l.current].direction.match(/[12].*[12]/);for(o.buffer=a?s.current:c.current,f&&(o.detune.value=50),o.connect(f&&i.current?i.current:a&&d.current?d.current:t.destination),o.start(),e=l.current+1;r.arrows[e]&&r.arrows[e].offset<=n;e++);l.current=e}}),[n]);var v=o.a.useRef(0);o.a.useEffect((function(){if(t&&a.current&&d.current&&r.stops[v.current]&&r.stops[v.current].offset<=n){var e,o=new AudioBufferSourceNode(t);for(o.buffer=a.current,o.connect(d.current),o.start(),e=v.current+1;r.stops[e]&&r.stops[e].offset<=n;e++);v.current=e}}),[n]);var m=o.a.useRef(0);return o.a.useEffect((function(){n<m.current&&(p.current=n-n%.25+.25,l.current=r.arrows.findIndex((function(e){return n<e.offset})),v.current=r.stops.findIndex((function(e){return n<e.offset}))),m.current=n}),[n,r]),null},E=o.a.createElement,S=function(e){var t=e.chart,r=o.a.useRef(),n=a(o.a.useState(0),2),c=n[0],s=n[1],u=a(o.a.useState(),2),i=u[0],d=u[1],p=o.a.useRef(0),h=o.a.useMemo((function(){var e=function(e){var t=[].concat(Object(f.a)(e.bpm.map((function(e){return{offset:e.startOffset,bpm:e.bpm}}))),Object(f.a)(e.stops.map((function(e){return{offset:e.offset,stop:e.duration}})))).sort((function(e,t){return e.offset-t.offset})),r=[{time:0,offset:0,bpm:t.shift().bpm}];return t.forEach((function(e){var t=r[0].bpm,n=4*(e.offset-r[0].offset)/t*60,o=r[0].time+n;"bpm"in e?r.unshift({time:o,offset:e.offset,bpm:e.bpm}):(r.unshift({time:o,offset:e.offset,bpm:0}),r.unshift({time:o+e.stop,offset:e.offset,bpm:t}))})),r.reverse()}(t);return function(t){var r;for(r=p.current;e[r+1]&&e[r+1].time<t;r++);return p.current=r,(t-e[r].time)*e[r].bpm/60/4+e[r].offset}}),[t]),l=o.a.useCallback((function(){i||d(new AudioContext),r.current=(new Date).getTime(),p.current=0}),[i,d]);return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=o.a.useRef();o.a.useEffect((function(){return t.current=requestAnimationFrame((function r(){t.current=requestAnimationFrame(r),e()})),function(){t.current&&cancelAnimationFrame(t.current)}}),[e])}(o.a.useCallback((function(){r.current?s(h(((new Date).getTime()-r.current)/1e3)):s(0)}),[s])),E("div",{style:{display:"flex"}},E(k,{chart:t,speed:2,offset:c}),E(A,{audioContext:i,chart:t,offset:c}),E("button",{onClick:l},"Play"))},j=o.a.createElement,R=!0;t.default=function(e){var t=e.chart;return j(S,{chart:t})}},a3WO:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,"a",(function(){return n}))},o0o1:function(e,t,r){e.exports=r("ls82")},vnkr:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[mix]/[title]/[type]",function(){return r("N+kb")}])}},[["vnkr",0,2,1]]]);